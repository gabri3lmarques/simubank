{"ast":null,"code":"// src/app/bank.service.ts\nimport { signal, computed } from '@angular/core';\nimport { tap, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class BankService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.apiUrl = 'http://localhost:3000'; // json-server default port\n    // State management with Signals\n    this.currentUser = signal(null);\n    this.userTransactions = signal([]);\n    this.isAuthenticated = computed(() => !!this.currentUser());\n    // Attempt to load user from session storage on service initialization\n    this.loadUserFromSessionStorage();\n  }\n  loadUserFromSessionStorage() {\n    const storedUser = sessionStorage.getItem('currentUser');\n    if (storedUser) {\n      this.currentUser.set(JSON.parse(storedUser));\n      // Optionally fetch transactions if user is already logged in\n      this.fetchTransactions(this.currentUser().id).subscribe();\n    }\n  }\n  login(accountId, password) {\n    return this.http.get(`${this.apiUrl}/users?id=${accountId}&password=${password}`).pipe(tap(users => {\n      if (users.length > 0) {\n        const user = users[0];\n        this.currentUser.set(user);\n        sessionStorage.setItem('currentUser', JSON.stringify(user));\n        this.fetchTransactions(user.id).subscribe();\n        this.router.navigate(['/dashboard']);\n      } else {\n        alert('Invalid Account ID or Password');\n      }\n    }));\n  }\n  logout() {\n    this.currentUser.set(null);\n    this.userTransactions.set([]);\n    sessionStorage.removeItem('currentUser');\n    this.router.navigate(['/login']);\n  }\n  fetchTransactions(userId) {\n    return this.http.get(`${this.apiUrl}/transactions?userId=${userId}&_sort=date&_order=desc`).pipe(tap(transactions => this.userTransactions.set(transactions)));\n  }\n  deposit(amount) {\n    const user = this.currentUser();\n    if (!user) throw new Error('No user logged in.');\n    const newBalance = user.balance + amount;\n    return this.updateUserBalance(user.id, newBalance).pipe(tap(updatedUser => {\n      this.currentUser.set(updatedUser);\n      sessionStorage.setItem('currentUser', JSON.stringify(updatedUser));\n      this.addTransaction(user.id, 'deposit', amount).subscribe();\n    }), map(() => user) // Return the original user or updated user if needed\n    );\n  }\n  withdraw(amount) {\n    const user = this.currentUser();\n    if (!user) throw new Error('No user logged in.');\n    if (user.balance < amount) {\n      alert('Insufficient balance.');\n      throw new Error('Insufficient balance.');\n    }\n    const newBalance = user.balance - amount;\n    return this.updateUserBalance(user.id, newBalance).pipe(tap(updatedUser => {\n      this.currentUser.set(updatedUser);\n      sessionStorage.setItem('currentUser', JSON.stringify(updatedUser));\n      this.addTransaction(user.id, 'withdrawal', amount).subscribe();\n    }), map(() => user) // Return the original user or updated user if needed\n    );\n  }\n  updateUserBalance(userId, newBalance) {\n    return this.http.patch(`${this.apiUrl}/users/${userId}`, {\n      balance: newBalance\n    });\n  }\n  addTransaction(userId, type, amount) {\n    const newTransaction = {\n      userId,\n      type,\n      amount,\n      date: new Date().toISOString()\n    };\n    return this.http.post(`${this.apiUrl}/transactions`, newTransaction).pipe(tap(transaction => {\n      this.userTransactions.update(transactions => [transaction, ...transactions]);\n    }));\n  }\n  static {\n    this.ɵfac = function BankService_Factory(t) {\n      return new (t || BankService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: BankService,\n      factory: BankService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","computed","tap","map","BankService","constructor","http","router","apiUrl","currentUser","userTransactions","isAuthenticated","loadUserFromSessionStorage","storedUser","sessionStorage","getItem","set","JSON","parse","fetchTransactions","id","subscribe","login","accountId","password","get","pipe","users","length","user","setItem","stringify","navigate","alert","logout","removeItem","userId","transactions","deposit","amount","Error","newBalance","balance","updateUserBalance","updatedUser","addTransaction","withdraw","patch","type","newTransaction","date","Date","toISOString","post","transaction","update","i0","ɵɵinject","i1","HttpClient","i2","Router","factory","ɵfac","providedIn"],"sources":["/home/gabe/Projects/bank-app/src/app/bank.service.ts"],"sourcesContent":["// src/app/bank.service.ts\nimport { Injectable, signal, computed } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { tap, map } from 'rxjs/operators';\nimport { User, Transaction } from './models';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class BankService {\n  private apiUrl = 'http://localhost:3000'; // json-server default port\n\n  // State management with Signals\n  currentUser = signal<User | null>(null);\n  userTransactions = signal<Transaction[]>([]);\n  isAuthenticated = computed(() => !!this.currentUser());\n\n  constructor(private http: HttpClient, private router: Router) {\n    // Attempt to load user from session storage on service initialization\n    this.loadUserFromSessionStorage();\n  }\n\n  private loadUserFromSessionStorage(): void {\n    const storedUser = sessionStorage.getItem('currentUser');\n    if (storedUser) {\n      this.currentUser.set(JSON.parse(storedUser));\n      // Optionally fetch transactions if user is already logged in\n      this.fetchTransactions(this.currentUser()!.id).subscribe();\n    }\n  }\n\n  login(accountId: string, password: string): Observable<User[]> {\n    return this.http.get<User[]>(`${this.apiUrl}/users?id=${accountId}&password=${password}`)\n      .pipe(\n        tap(users => {\n          if (users.length > 0) {\n            const user = users[0];\n            this.currentUser.set(user);\n            sessionStorage.setItem('currentUser', JSON.stringify(user));\n            this.fetchTransactions(user.id).subscribe();\n            this.router.navigate(['/dashboard']);\n          } else {\n            alert('Invalid Account ID or Password');\n          }\n        })\n      );\n  }\n\n  logout(): void {\n    this.currentUser.set(null);\n    this.userTransactions.set([]);\n    sessionStorage.removeItem('currentUser');\n    this.router.navigate(['/login']);\n  }\n\n  fetchTransactions(userId: string): Observable<Transaction[]> {\n    return this.http.get<Transaction[]>(`${this.apiUrl}/transactions?userId=${userId}&_sort=date&_order=desc`)\n      .pipe(\n        tap(transactions => this.userTransactions.set(transactions))\n      );\n  }\n\n  deposit(amount: number): Observable<User> {\n    const user = this.currentUser();\n    if (!user) throw new Error('No user logged in.');\n\n    const newBalance = user.balance + amount;\n    return this.updateUserBalance(user.id, newBalance).pipe(\n      tap(updatedUser => {\n        this.currentUser.set(updatedUser);\n        sessionStorage.setItem('currentUser', JSON.stringify(updatedUser));\n        this.addTransaction(user.id, 'deposit', amount).subscribe();\n      }),\n      map(() => user) // Return the original user or updated user if needed\n    );\n  }\n\n  withdraw(amount: number): Observable<User> {\n    const user = this.currentUser();\n    if (!user) throw new Error('No user logged in.');\n\n    if (user.balance < amount) {\n      alert('Insufficient balance.');\n      throw new Error('Insufficient balance.');\n    }\n\n    const newBalance = user.balance - amount;\n    return this.updateUserBalance(user.id, newBalance).pipe(\n      tap(updatedUser => {\n        this.currentUser.set(updatedUser);\n        sessionStorage.setItem('currentUser', JSON.stringify(updatedUser));\n        this.addTransaction(user.id, 'withdrawal', amount).subscribe();\n      }),\n      map(() => user) // Return the original user or updated user if needed\n    );\n  }\n\n  private updateUserBalance(userId: string, newBalance: number): Observable<User> {\n    return this.http.patch<User>(`${this.apiUrl}/users/${userId}`, { balance: newBalance });\n  }\n\n  private addTransaction(userId: string, type: 'deposit' | 'withdrawal', amount: number): Observable<Transaction> {\n    const newTransaction: Omit<Transaction, 'id'> = {\n      userId,\n      type,\n      amount,\n      date: new Date().toISOString()\n    };\n    return this.http.post<Transaction>(`${this.apiUrl}/transactions`, newTransaction).pipe(\n      tap(transaction => {\n        this.userTransactions.update(transactions => [transaction, ...transactions]);\n      })\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}